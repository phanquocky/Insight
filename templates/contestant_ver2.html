{% extends 'base.html' %}
{% block content %}

<script>
document.addEventListener("DOMContentLoaded", function() {
  const roomIds = document.querySelectorAll('.room-id');
  roomIds.forEach(roomId => {
    roomId.addEventListener("click", function() {
      const roomIdValue = this.textContent;
      window.location.href = `/contestant/${roomIdValue}`;
    });
  });
});
</script>

  <h1 class="text-center mt-3">Contestant Room</h1>

  {% if contestant_rooms %}
    <table class="table table-bordered mt-3 text-center">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">RoomID</th>
          <th scope="col">Previous score</th>
          <th scope="col">Target score</th>
          <th scope="col">Number of test completed</th>
          <th scope="col">Final result</th>
        </tr>
      </thead>

      <tbody class="overflow-auto">
        {% for contestant in contestant_rooms %}
          {% set completedTestCount = 0 %}

          {% for test in contestant.tests %}
            {% if test is defined %}
              {% set completedTestCount = completedTestCount + 1 %}
            {% endif %}
          {% endfor %}

        <tr>
          <th scope="row" class="col-1">{{ loop.index }}</th>
          <td class="col-3 room-id">{{ contestant._id }}</td>
          <td class="col-2">{{ contestant.prev_score }}</td>
          <td class="col-2">{{ contestant.want_score }}</td>
          <td class="col-2">{{ completedTestCount }}</td>
          <td class="col-2">{{ contestant.final_result }}</td>
        </tr>
          {% endfor %}
      </tbody>
    </table>

  {% else %}
    <h2 class="text-center mt-3">No room found</h2>
  {% endif %}

{% endblock %}